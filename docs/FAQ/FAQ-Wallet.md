# BTCPay Server Wallet FAQ

This document contains frequently asked questions and solutions to common issues related to BTCPay Server's [internal wallet](Wallet.md)

* [What is BTCPay Server wallet](#what-is-btcpay-server-wallet)
* [Do I have to use BTCPay Server wallet?](do-i-have-to-use-btcpay-server-wallet)
* [How to connect my wallet](#how-to-connect-my-wallet-to-btcpay-server)
- [Can I use a hardware wallet with BTCPay Server](can-i-use-a-hardware-wallet-with-btcpay-server)
* [Missing payments in wallet](#missing-payments-in-my-software-or-hardware-wallet)
* [Electrum and Zap show different addresses](#receiving-address-in-zap-and-electrum-is-different)
* [What is a derivation scheme?](#what-is-a-derivation-scheme)

## What is BTCPay Server wallet?

BTCPay Server has an internal wallet which you can use to preview incoming and outgoing transactions and manage your funds. It works like any other wallet, but has enhanced privacy features by default, and also solves certain UX problems you may encounter when using an external wallet with BTCPay Server. For more information on how to use the built-in wallet [check this page](Wallet.md). To use the internal wallet, you first need to [set up the wallet](WalletSetup.md) with your BTCPay store.

## How to set up my wallet with BTCPay Server?

Check our in-depth documentation on [how to set up your wallet](WalletSetup.md).

## Can I use a hardware wallet with BTCPay Server?

The internal wallet has a [built in hardware wallet integration](Vault.md). You can use a supported hardware wallet with the [BTCPay wallet](Wallet.md). This further means that you're using a hardware wallet without leaking information to third-party apps or servers, since the wallet relays on the full node in your BTCPay.
 
## Do I have to use BTCPay Server wallet?

By default BTCPay Server requires only extended public key. To receive payments to your BTCPay store, you only need to provide an extended public key which you can generate in an external wallet. This means that you do not have to use a built in wallet at all, you can manage funds in your [existing wallet](/WalletSetup/#use-an-existing-wallet).

However, it's recommended to use a built in wallet for funds management. The built in wallet improves your privacy by default, but also solves user-experience issues like [gap-limit](#missing-payments-in-my-software-or-hardware-wallet).

## Missing payments in my software or hardware wallet

If your internal BTCPay wallet is showing the transactions and you do not see the funds on your desktop, mobile or hardware wallet, you need to **increase the gap limit** of the external wallet you're using. Do not worry, your funds are safe, they're just not showing yet.

Most wallets, have a gap limit of 20. This means that after 20 consecutive unpaid invoices, wallet will stop fetching the transactions beyond that and won't show them. The solution is to increase the gap limit. Not all wallets have this feature.

For that reason, it's highly recommended that you use [Electrum wallet](https://electrum.org/). To set increase the gap limit in Electrum, [follow this video](https://www.youtube.com/watch?v=Fi3pYpzGmmo)

Enter following commands in Electrum console:

```
 wallet.change_gap_limit(100)
 wallet.storage.write()
```
Restart your Electrum and verify that the newly set gap limit is correct by entering:

`wallet.gap_limit`

There's no good answer to how much you should set the gap limit to. Most merchants set 100-200. If you're a big merchants with high transaction volume, you can try with an even higher gap limit.

Be aware that :

* A higher gap limit may slow down the performance of your wallet
* Not all wallets support the increased gap limit. If you import an Electrum recovery seed into another wallet, you may not see all the funds again.

When an invoice is created in BTCPay, it does it for all coins you have setup. You may want to increase the gap limit for altcoins as well in their supported wallets.

If you do not see your funds yet, you may have set up your derivation scheme incorrectly.

## Receiving address in Zap and Electrum is different?

Zap and Electrum are two different wallets. Zap is for [Lightning Network](LightningNetwork.md) and Electrum is for on-chain transactions. They are unrelated and use different private keys. Use Electrum or internal [BTCPay wallet](Wallet.md) to check your on-chain payments and Zap for your Lightning Network payments.

In the future, there will be wallets merging both on-chain and off-chain transactions into one, but for now, you have to use them separately.

## What is a derivation scheme?

In order to receive payments to your BTCPay Server, you need to connect a wallet in your Store Settings by providing an xpubkey generated by your own wallet software. BTCPay uses what is called a `derivation scheme` to represent the destination of the funds received by your invoices. The destination of those funds will be your wallet, located by the xpubkey that you provide.

Using different derivation schemes with your xpub, you can also choose to create various receiving address types, shown in your store invoices.

|Address Type|	Example |
|:--|:--:|
|P2WPKH |	xpub... |
|P2SH-P2WPKH	| xpub...-[p2sh] |
|P2PKH	| xpub...-[legacy] |
|Multi-sig P2WSH	| 2-of-xpub1...-xpub2... |
|Multi-sig P2SH-P2WSH	| 2-of-xpub1...-xpub2...-[p2sh] |
|Multi-sig P2SH |	2-of-xpub1...-xpub2...-[legacy] |
